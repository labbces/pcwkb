{% extends "base.html" %}

{% block content %}

<p> {% if scientific_name %}

<header>
  <div class="container">
    <div class="row justify-content-md-center">
      <div class="col-12 col-md-10 col-lg-8 col-xl-7 col-xxl-6">
        <h2 class="mb-4 display-5 text-center">{{ scientific_name }}</h2>
        <hr class="w-50 mx-auto mb-5 mb-xl-9 border-success-subtle">
        {% if common_name %}
        <h4 class="text-secondary mb-5 text-center"> Common Name: {{ common_name }} <br> Species Code: {{ species_code }} </h4>
        {% else %}
        <h4 class="text-secondary mb-5 text-center"> Species Code: {{ species_code }} </h4>
        {% endif %}
      </div>
    </div>
  </div>
</header>

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
  }

  a {
    color: rgb(25 135 84);
    text-decoration: none;
    font-weight: bold;
  }

</style>

<div class="b-example-divider"></div>

{% endif %} </p>

{% if biomass_composition %}
  
  {{ biomass_composition|json_script:"biomass_composition" }}
  <div class="row justify-content-md-center">
    <script>
    const scientificName = '{{ scientific_name }}'
    const biomasscomp = JSON.parse(document.getElementById('biomass_composition').textContent);
    </script>
    {% if biomass_composition|length > 1 %}
      <div id="grafico"></div>
      <div id="grafico2" style="width: 1400px; height: 800px;"></div>
      <script src="https://cdn.anychart.com/releases/8.12.0/js/anychart-core.min.js"></script>
      <script src="https://cdn.anychart.com/releases/8.12.0/js/anychart-heatmap.min.js"></script>
      <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
      <script src="/static/script/species/species_morepiecharts.js"></script>
      <script src="/static/script/species/species_heatmap.js"></script>
    {% else %}
      {% for key in biomass_composition %}
        <h4> Biomass composition pie chart for PO {{ key }} </h4>
      {% endfor %}
      <div id="grafico"></div>
      <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
      <script src="/static/script/species/species_singlepiechart.js"></script>
    {% endif %}
  </div>
{% else %}
  <div class="row justify-content-md-center">
    <h4 class="text-secondary mb-5 text-center"> Species without biomass composition data </h4>
  </div>
{% endif %}

  {% if genes_paginated %}


  <h4>Plant Cell Wall-related Genes</h4>

  <table class="table" text-align="center" id="data-table">
    <thead>
      <tr>
        <th scope="col">Gene Name</th>
        <th scope="col">Description</th>
      </tr>
    </thead>
    <tbody>

    </tbody>
  </table>

  <div id="pagination-links">

  </div>

  <script>

    function loadTableData(page) {
      fetch(`/pcwkb_core/gene_list/{{ species_id }}?page=${page}`)
        .then(response => response.json())
        .then(data => {
          const tableBody = document.getElementById('data-table').getElementsByTagName('tbody')[0];
          tableBody.innerHTML = '';  // Clear current table data

          data.data.forEach(rowData => {
            const row = tableBody.insertRow();
            const cell1 = row.insertCell(0);
            cell1.innerHTML = `<a href="http://127.0.0.1:8000/pcwkb_core/gene_page/${rowData.gene_name}">${rowData.gene_name}</a>`;
            const cell2 = row.insertCell(1);
            cell2.innerHTML = rowData.description;
          });

          // Handle pagination links
          const paginationLinks = document.getElementById('pagination-links');
          paginationLinks.innerHTML = '';  // Clear current pagination links

          for (let i = 1; i <= data.num_pages; i++) {
            const link = document.createElement('a');
            link.innerText = i;
            link.href = '#';
            link.addEventListener('click', () => loadTableData(i));
            paginationLinks.appendChild(link);
          }
        });
    }

    // Load first page on page load
    loadTableData(1);

  </script>
  
  {% else %}

  <p>No genes found for this species.</p>

  {% endif %}

  </html>

  {% endblock %}