{% extends "base.html" %}
{% block content %}
{% load static %}

<div class="container-fluid px-4 py-3">
    <nav aria-label="breadcrumb">
    <ol class="breadcrumb rounded-pill px-3 border border-success pcwkb-bg-color">
        <li class="breadcrumb-item"><a href="{% url 'index' %}">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Gene family</li>
        <li class="breadcrumb-item active" aria-current="page">{{ orthogroup }}</li>
      </ol>
    </nav>
  </div>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="{% static 'script/orthogroup/d3.v3.min.js' %}"></script>
    <script src="{% static 'script/orthogroup/phyd3.min.js' %}"></script>
    <link rel="stylesheet" href="{% static 'script/orthogroup/phyd3.css' %}" />

</head>
<header class="py-3 py-md-5 py-xl-8 ">
    <div class="px-4">
      <div class="row justify-content-md-center">
        <div class="col-12 col-md-10 col-lg-8 col-xl-7 col-xxl-6">
          <h2 class="mb-4 display-5 text-center"> Orthogroup: {{ orthogroup }} </h2>
          <hr class="w-50 mx-auto mb-5 mb-xl-9 border-success-subtle">
        </div>
      </div>
        <table class="table table-responsive">
            <tbody>
                <tr>
                    <td class="w-50">
                        <h6>Tool: {{ method.tool }}</h6>
                    </td>
                    <td class="w-50">
                        <h6>Version: {{ method.version }}</h6>
                    </td>
                </tr>
                <tr>
                    <td class="w-50">
                        <h6>Run: {{ method.run }}</h6>
                    </td>
                    <td class="w-50">
                        {% if method.description %}
                        <h6>Description: {{ method.description }}</h6>
                        {% endif %}
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</header>

<section class="px-4 py-8">
    <div class="py-4 rounded-5 pcwkb-bg-color">
        <p><strong>Proteins in this Orthogroup:</strong></p>
        <ul>
            {% for og in proteins %}
            <li><a href="{% url 'gene_page' gene_name=og.protein.gene.gene_name %}">{{ og.protein.protein_name }}</a></li>
            {% empty %}
            <li>No proteins found in this orthogroup.</li>
            {% endfor %}
        </ul>
    </div>
</section>

{% if orthogroup.tree %}

    <body onload="load()">
        <section class="mx-auto p-4">
            <div class="rounded-top-5 pcwkb-bg-color">
                <h2 class="text-center p-2">Tree</h2>
                <button id="resetZoom">Reset Zoom</button>
                <button id="linkPNG">Generate PNG</button>
                <button id="zoominY">Zoom in Y</button>
                <button id="zoominX">Zoom in X</button>
                <button id="zoomoutY">Zoom out Y</button>
                <button id="zoomoutX">Zoom out X</button>
                <button id="nodeHeightHigher">Text +</button>
                <button id="nodeHeightLower">Text -</button>
                <div class="border border-success">
                    <div id="phyd3"></div>
                </div>
            </div>
        </section>

    </body>

    <script>

        var opts = {
            height: 1000,
            domainWidth: 200,
            dynamicHide: true,
            invertColors: false,
            lineupNodes: true,
            showDomains: true,
            showDomainNames: false,
            showDomainColors: false,
            showGraphs: true,
            showGraphLegend: false,
            showSupportValues: false,
            maxDecimalsSupportValues: 1,
            showLengthValues: false,
            maxDecimalsLengthValues: 3,
            showLength: false,
            showNodeNames: true,
            showNodesType: "all",
            showPhylogram: false,
            showTaxonomy: false,
            showFullTaxonomy: true,
            showSequences: false,
            showTaxonomyColors: true,
            backgroundColor: "#ffffff",
            foregroundColor: "#000000",
            popupAction: false,
            nodeHeight: 7,
        };

        function load() {
            d3.select("#phyd3").text(null);
            var tree = phyd3.newick.parse("{{ orthogroup.tree }}")
            phyd3.phylogram.build("#phyd3", tree, opts);
        };
    </script>
{% else %}
<div class="mx-auto p-4">
    <div class="p-4 rounded-top-5 pcwkb-bg-color">
        <h5>No orthogroup tree found for this orthogroup</h5>
{%endif%}

{% endblock %}