{% extends "base.html" %}
{% block content %}
{% load static %}

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="{% static 'script/orthogroup/d3.v3.min.js' %}"></script>
    <script src="{% static 'script/orthogroup/phyd3.min.js' %}"></script>
    <link rel="stylesheet" href="{% static 'script/orthogroup/phyd3.css' %}" />

</head>
<div class="p-4">
    <div class="background-color-88b993 rounded-top-5">
        <h1 class="text-center">Orthogroup: {{ orthogroup }}</h1>
        <table class="table table-responsive">
            <tbody>
                <tr>
                    <td class="w-50">
                        <h6>Tool: {{ method.tool }}</h6>
                    </td>
                    <td class="w-50">
                        <h6>Version: {{ method.version }}</h6>
                    </td>
                </tr>
                <tr>
                    <td class="w-50">
                        <h6>Run: {{ method.run }}</h6>
                    </td>
                    <td class="w-50">
                        {% if method.description %}
                        <h6>Description: {{ method.description }}</h6>
                        {% endif %}
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="p-4">
    <div class="background-color-f5f5f5 rounded-bottom-5">
        <p><strong>Proteins in this Orthogroup:</strong></p>
        <ul>
            {% for og in proteins %}
            <li><a href="pcwkb_core/gene_page/{{og.protein.gene}}">{{ og.protein.protein_name }}</a></li>
            {% empty %}
            <li>No proteins found in this orthogroup.</li>
            {% endfor %}
        </ul>
    </div>
</div>

{% if orthogroup.tree %}

    <body onload="load()">
        <div class="mx-auto p-4">
            <div class="p-4 background-color-f5f5f5 rounded-top-5">
                <h2 class="text-center p-2">Tree</h2>
                <button id="resetZoom">Reset Zoom</button>
                <button id="linkPNG">Generate PNG</button>
                <button id="zoominY">Zoom in Y</button>
                <button id="zoominX">Zoom in X</button>
                <button id="zoomoutY">Zoom out Y</button>
                <button id="zoomoutX">Zoom out X</button>
                <button id="nodeHeightHigher">Text +</button>
                <button id="nodeHeightLower">Text -</button>
                <div class="border border-success">
                    <div id="phyd3"></div>
                </div>
            </div>
        </div>

    </body>

    <script>

        var opts = {
            height: 1000,
            domainWidth: 200,
            dynamicHide: true,
            invertColors: false,
            lineupNodes: true,
            showDomains: true,
            showDomainNames: false,
            showDomainColors: false,
            showGraphs: true,
            showGraphLegend: false,
            showSupportValues: false,
            maxDecimalsSupportValues: 1,
            showLengthValues: false,
            maxDecimalsLengthValues: 3,
            showLength: false,
            showNodeNames: true,
            showNodesType: "all",
            showPhylogram: false,
            showTaxonomy: false,
            showFullTaxonomy: true,
            showSequences: false,
            showTaxonomyColors: true,
            backgroundColor: "#ffffff",
            foregroundColor: "#000000",
            popupAction: false,
            nodeHeight: 7,
        };

        function load() {
            d3.select("#phyd3").text(null);
            var tree = phyd3.newick.parse("{{ orthogroup.tree }}")
            phyd3.phylogram.build("#phyd3", tree, opts);
        };
    </script>
{% else %}
<div class="mx-auto p-4">
    <div class="p-4 background-color-f5f5f5 rounded-top-5">
        <h5>No orthogroup tree found for this orthogroup</h5>
{%endif%}

{% endblock %}